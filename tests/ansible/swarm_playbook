---
- hosts: all
  name: Provisioning tasks
  roles:
    - common
    - docker
    - private_net

- hosts: all
  name: Setup swarm
  roles:
    - swarm

- hosts: managers[0]
  name: Setup local registry
  roles:
    - registry

- hosts: managers[0]
  name: Install GH runner
  vars:
    - runner_user: debian
    - access_token: "{{ lookup('env', 'GITHUB_TOKEN') }}"
    - runner_extra_config_args: "--ephemeral"
    - runner_name: bw-swarm
    - github_account: "{{ lookup('env', 'GITHUB_ACCOUNT') }}"
    - github_owner: bunkerity
    - github_repo: bunkerweb
    - runner_labels:
        - bw-swarm
  roles:
    - monolithprojects.github_actions_runner
